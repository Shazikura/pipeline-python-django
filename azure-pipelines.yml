trigger:
- master

pool:
  name: Default

stages:
  - stage: Build
    displayName: Build Stage
    jobs: 
      - job: Buildjob
        displayName: Build Stage - Job.1
        steps:
        - task: AzureCLI@2
          inputs:
            azureSubscription: 'Free Trial(21ffa5d8-e7c7-481b-8a23-e5f94872f1fd)'
            scriptType: 'ps'
            scriptLocation: 'inlineScript'
            inlineScript: |
                  az acr login --name ACRlearning
                  docker login ACRlearning
                  docker build -t nginx . 
                  docker push ACRlearning.azurecr.io/nginx

  - stage: Deploy
    displayName: Deployment Stage
    jobs:
      - deployment: DeploymentJob
        displayName: Deployment Stage - Job.1
        environment: String 
        strategy:
         runOnce: 
          deploy:
            steps:
             - task: PowerShell@2
               inputs:
                targetType: 'inline'
                script: |
                 Write-Host "Hello World"

  - stage: Test
    displayName: Testing Stage
    jobs:
      - job: Testingjob
        displayName: Testing Stage - Job.1
        steps:
          - task: PowerShell@2
            inputs:
              targetType: 'inline'
              script: |
               Write-Host "Hello World"
